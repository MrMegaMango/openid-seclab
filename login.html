<!DOCTYPE html>
<html>
  <head>
    <title>Login</title>
    <style>
      #login_error {
        color: red;
        font-size: 2em;
        font-weight: bold;
        display: none;
      }
    </style>
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const errDiv = document.getElementById('login_error');
        const urlParams = new URLSearchParams(window.location.search);
        const err = urlParams.get('error');
        if (err != null && err !== "") {
          errDiv.style.display = 'block';
          errDiv.innerText = err;
        }
      });
    </script>
  </head>
  <body>
    <form method="POST" action="/login">
      <div id="login_error"></div>
      <p><label name="username">Username: <input type="text" name="username"></label></p>
      <p><label name="password">Password: <input type="password" name="password"></label></p>
      <p><input type="submit" value="Login"></p>
    </form>
    <script> 
          function reqJSON(method, path, data) {
        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.open(method, path, true);
          xhr.setRequestHeader('Content-type', 'application/json');
          xhr.responseType = 'json';
          function resp() {
            return {
              status: xhr.status,
              statusText: xhr.statusText,
              data: xhr.response,
            };
          };
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              resolve(resp());
            } else {
              console.error('xhr with error:', xhr);
              reject(resp());
            }
          };
          xhr.onerror = () => {
            console.error('xhr with error:', xhr);
            reject(resp());
          };
          xhr.send(JSON.stringify(data))
        });
      }

  
    //reqJSON("GET","/csrf");
    //const stater = document.getElementById('state')
   // var state = {{ state }};
//    console.log('state');
//    console.log(state);
    //document.write(' <a href="https://accounts.google.com/o/oauth2/v2/auth?response_type=code&client_id=825981190989-4h5mlcl6nsi7d30hrd66aimr5a6vgon9.apps.googleusercontent.com&scope=openid%20email&state='+state+'&nonce=1234&redirect_uri=https%3A//openid-seclab.appspot.com/oidcauth">Login with Google</a>')
    document.write(' <a href="https://accounts.google.com/o/oauth2/v2/auth?response_type=code&client_id=825981190989-4h5mlcl6nsi7d30hrd66aimr5a6vgon9.apps.googleusercontent.com&scope=openid%20email&state=abcd1234&nonce=1234&redirect_uri=https%3A//openid-seclab.appspot.com/oidcauth">Login with Google</a>')
   </script>
   
    <p>Or you can <a href="/register">register</a>.</p>
  </body>
</html>
